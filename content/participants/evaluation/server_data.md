---
date: '2025-10-30T14:00:00+09:00'
draft: false
title: 'ゲームサーバからのデータ'
category: participants_guide
---

このページでは、**ゲームサーバ（aiwolf-nlp-server）からエージェントに送られてくるデータ**を、

* どこで取得し
* どのような構造（Packet）で届き
* どこを見れば何が分かるか

について解説します。

> 詳細は以下の原典を参照してください。
>
> * [プロトコルの実装について](https://github.com/aiwolfdial/aiwolf-nlp-server/blob/main/doc/ja/config.md)
> * [オブジェクトに変換](https://github.com/aiwolfdial/aiwolf-nlp-common)
>

---

## サーバから届く **Packet** の全体像

サーバ→エージェントに送られるメッセージは **JSON の Packet** です。主なキーは次のとおりです。

| キー                | 型                   | 役割            | よく見る場面                                  |
| ----------------- | ------------------- | ------------- | --------------------------------------- |
| `request`         | `Request`（列挙）       | どの種類のリクエストか   | `NAME`, `INITIALIZE`, `TALK`, `VOTE`, … |
| `info`            | `Info` or `null`    | **現時点のゲーム状態** | 日数・自分の名前・直近の結果・生死状況など                   |
| `setting`         | `Setting` or `null` | **ゲーム設定**     | 参加人数・役職数・発言制限・タイムアウトなど                  |
| `talk_history`    | `Talk[]` or `null`  | **新規の会話差分**   | 直近に増えた Talk のみ（全履歴ではない）                 |
| `whisper_history` | `Talk[]` or `null`  | **新規の囁き差分**   | 人狼同士の囁き（条件付き）                           |

> ⚠️ `talk_history` / `whisper_history` は **差分のみ** が届きます。
> フル履歴を見たい場合は、**パケットを順に蓄積**して再構築してください。

---

## **Request**（リクエスト種別）と、エージェントが返すべき内容

サーバは状況に応じて次のリクエストを送ります。**何を返せば良いか**を即分かるようにまとめました。

| リクエスト              | 目的          | エージェントのレスポンス                                                          |
| ------------------ | ----------- | --------------------------------------------------------------------- |
| `NAME`             | 接続直後の「名前」要求 | **チーム名＋連番の文字列**（例：`kanolab1`）。後ろの数字を除いた部分がチーム名に。                      |
| `INITIALIZE`       | ゲーム開始       | **返答なし**                                                              |
| `DAILY_INITIALIZE` | 昼開始（新しい日）   | **返答なし**                                                              |
| `TALK`             | 昼の発言        | **自然言語の文字列**（例：`こんにちは`）。発言制限は `setting.talk.*` と `info.remain_*` を確認。 |
| `WHISPER`          | 人狼の囁き       | **自然言語の文字列**。条件を満たすときにのみ狼へ送られる。                                       |
| `VOTE`             | 昼の追放投票      | **対象エージェント名**（例：`Agent[01]`）                                          |
| `DIVINE`           | 占い対象の指定     | **対象エージェント名**（占い師のみ）                                                  |
| `GUARD`            | 護衛対象の指定     | **対象エージェント名**（騎士のみ；自分自身は不可）                                           |
| `ATTACK`           | 襲撃投票        | **対象エージェント名**（人狼のみ）                                                   |
| `DAILY_FINISH`     | 夜開始（昼の締め）   | **返答なし**（直前までの会話差分が届く）                                                |
| `FINISH`           | ゲーム終了       | **返答なし**（`info.role_map` に最終の全役職が含まれる）                                |

---

## **Info**（現在のゲーム状態）で必ず見るところ

`info` は **“今の状況”** を要約します。よく使うフィールドだけを抜粋します。

* `game_id`：ゲーム識別子
* `day`：現在の日数（0日目の昼から開始）
* `agent`：**自分**（このパケットの宛先エージェント）
* `status_map`：各エージェントの **生存状態（ALIVE/DEAD）**
* `role_map`：**自分の役職**は常に見える。**終了時（FINISH）**のみ **全員分** が見える
* `vote_list`：公開設定なら **昼の投票結果**
* `attack_vote_list`：**人狼宛て**かつ公開設定なら **襲撃投票結果**
* `executed_agent` / `attacked_agent`：直近の追放/襲撃の結果
* `divine_result` / `medium_result`：自分が占い師/霊媒師のときに結果が入る
* `remain_count` / `remain_length` / `remain_skip`：**TALK/WHISPER 時だけ**届く残り回数・残り文字数・残りスキップ数

---

## **Setting**（ゲーム設定）で把握しておくこと

* `agent_count`：参加人数（例：5 or 13）
* `role_num_map`：役職ごとの人数（5人/13人の内訳確認に）
* `vote_visibility`：投票結果を公開するか（`info.vote_list` の出現に影響）
* `talk.*` / `whisper.*`：発言回数・文字数・スキップの制限
* `vote.*` / `attack_vote.*`：再投票や自己投票の可否、襲撃なし許可など
* `timeout.*`：アクションやヘルスチェックのタイムアウト（ms）

> `INITIALIZE` で `setting` が届きます。`FINISH` では `setting` は送られません。

---

以上で、**サーバーから送られるデータの見方と、最小限のチェック方法**は完了です。

---

[参加者マニュアルトップへ](../_index.md)\
[確認・評価トップへ](./_index.md)\
[前へ（エージェント起動方法）](../execution/agent.md)\
[次へ（ゲームログの見方）](./game_log_guide.md)
